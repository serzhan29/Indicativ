{% extends 'base.html' %}
{% load static %}

{% block content %}

<div style="display: flex; gap: 30px;">

    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º —Å–ª–µ–≤–∞ -->
    <div style="width: 250px; background: #f9f9f9; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
        <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">–§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º</h3>

        <form method="GET" action="">
            <label for="direction" style="font-size: 14px; color: #333; margin-bottom: 10px; display: block;">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
            <select name="direction" id="direction" style="width: 100%; padding: 8px 12px; font-size: 14px; border: 1px solid #ddd; border-radius: 6px;">
                <option value="">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
                {% for direction in directions %}
                    <option value="{{ direction.id }}" {% if direction.id == selected_direction %}selected{% endif %}>
                        {{ direction.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" style="margin-top: 15px; background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer;">
                –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
            </button>
        </form>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
    <div style="flex-grow: 1;">
        <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">
            üìä –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –≥–ª–∞–≤–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º –¥–ª—è {{ teacher.get_full_name }}
        </h1>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
            .chart-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-bottom: 40px;
            }

            .chart-card {
                background: #fff;
                border: 1px solid #ddd;
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                height: 300px; /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
                overflow: hidden;
                transition: box-shadow 0.3s ease;
            }

            .chart-card:hover {
                box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            }

            .chart-title {
                font-size: 14px;
                font-weight: 600;
                color: #333;
                margin-bottom: 4px;
                max-height: 40px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .chart-unit {
                font-size: 12px;
                color: #888;
                margin-bottom: 10px;
            }

            @media (max-width: 1024px) {
                .chart-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
            }

            @media (max-width: 600px) {
                .chart-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>

        {% if year_values.0.main_indicators %}
            <div class="chart-grid">
                {% for main in year_values.0.main_indicators|slice:":6" %}
                    <div class="chart-card">
                        <div>
                            <div class="chart-title" title="{{ main.code }} ‚Äî {{ main.name }}">
                                {{ main.code }} ‚Äî {{ main.name }}
                            </div>
                            <div class="chart-unit">–ï–¥–∏–Ω–∏—Ü–∞: {{ main.unit }}</div>
                        </div>

                        <canvas id="chart-{{ forloop.counter }}" height="160"></canvas>

                        <script>
                            const ctx{{ forloop.counter }} = document.getElementById("chart-{{ forloop.counter }}").getContext("2d");

                            new Chart(ctx{{ forloop.counter }}, {
                                type: "line",
                                data: {
                                    labels: [{% for y in year_values %}"{{ y.year }}",{% endfor %}],
                                    datasets: [{
                                        label: "{{ main.name }}",
                                        data: [
                                            {% for y in year_values %}
                                                {% for m in y.main_indicators %}
                                                    {% if m.code == main.code %}
                                                        {{ m.value }},
                                                    {% endif %}
                                                {% endfor %}
                                            {% endfor %}
                                        ],
                                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 2,
                                        tension: 0.3,
                                        pointRadius: 3,
                                        fill: true
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    plugins: {
                                        legend: { display: false },
                                        tooltip: { enabled: true }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: { display: true, text: "{{ main.unit }}" }
                                        },
                                        x: {
                                            title: { display: true, text: "–ì–æ–¥—ã" }
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #888; font-size: 16px; margin-top: 30px;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤. –û—Ç—á–µ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.</p>
        {% endif %}
    </div>
</div>

{% endblock %}
